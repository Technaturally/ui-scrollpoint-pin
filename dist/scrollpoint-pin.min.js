/*!
 * angular-ui-scrollpoint-pin
 * https://github.com/TechNaturally/ui-scrollpoint-pin
 * Version: 2.1.0 - 2016-02-19T23:21:19.718Z
 * License: MIT
 */
!function(){"use strict";angular.module("ui.scrollpoint.pin",["ui.scrollpoint"]).factory("ui.scrollpoint.Pin",["$timeout",function(e){var t={hide:function(e){!e.$element||!e.isPinned()||e.group&&e==e.group.active||(angular.isFunction(e.$element.hide)?e.$element.hide():e.$element.css("visibility","hidden"))},show:function(e){e.$element&&(angular.isFunction(e.$element.show)?e.$element.show():e.$element.css("visibility",null))},getOffset:function(e,t){var i;if(e&&e.$uiScrollpoint){var o=e.getOriginalBounds(),n=e.$uiScrollpoint,r=n.getEdge(t);if(r)for(var s in r){var l=n.getEdge(t,s);if(l){var a;l.absolute?(a=l.percent?l.shift/100*n.getTargetScrollHeight():l.shift,"bottom"==t&&(a=n.getTargetContentHeight()-a,n.hasTarget&&(a+=n.getTargetHeight()))):("top"==s?a=o.top:"bottom"==s&&(a=o.bottom),a+=l.shift),(angular.isUndefined(i)||a>=i)&&(i=a)}}}return i}},i={groups:{},newGroup:function(e){return{id:e,items:[],active:{},addItem:function(e){-1==this.items.indexOf(e)&&(this.items.push(e),e.group=this,e.$element&&e.$element.addClass("pin-grouped pin-group-"+this.id),this.refreshActive(e))},removeItem:function(e){var i=this.items.indexOf(e);-1!=i&&this.items.splice(i,1),e.group==this&&(e.group=void 0),e.$element&&e.$element.removeClass("pin-grouped pin-group-"+this.id),t.show(e),this.refreshActive(e)},refreshActive:function(e,i){if(e&&e.$uiScrollpoint){var o=e.$uiScrollpoint.edges;for(var n in o)if(angular.isUndefined(i)||n==i){for(var r,s,l=0;l<this.items.length;l++){var a=this.items[l];if(a.isPinned()&&a.$uiScrollpoint&&a.edge&&a.edge.scroll==n){var c=t.getOffset(a,n);angular.isDefined(c)&&(angular.isUndefined(r)||"top"==n&&c>=r||"bottom"==n&&r>=c)&&(r=c,s=a)}}this.active[n]=s,this.refreshVisibility(n),s&&t.show(s)}}},refreshVisibility:function(e){for(var i=0;i<this.items.length;i++){var o=this.items[i];o.isPinned()&&o.edge&&o.edge.scroll==e&&o!=this.active[e]&&t.hide(o)}},getActive:function(e){return this.active[e]?this.active[e]:void 0},getFirst:function(e){for(var i,o,n=0;n<this.items.length;n++){var r=this.items[n],s=t.getOffset(r,e);angular.isDefined(s)&&(angular.isUndefined(o)||"top"==e&&o>=s||"bottom"==e&&s>=o)&&(o=s,i=r)}return i},pinned:function(e,t){this.refreshActive(e,t.scroll)},unpinned:function(e,i){this.refreshActive(e,i.scroll),t.show(e)}}},getGroupSet:function(e){var t;return e.$uiScrollpoint&&e.$uiScrollpoint.hasTarget&&e.$uiScrollpoint.$target?(angular.isUndefined(e.$uiScrollpoint.$target.groups)&&(e.$uiScrollpoint.$target.groups={}),t=e.$uiScrollpoint.$target.groups):t=this.groups,t},register:function(e,t){var i=this.getGroupSet(e);angular.isUndefined(i[t])&&(i[t]=this.newGroup(t)),i[t].addItem(e)},unregister:function(e,t){var i=this.getGroupSet(e);t&&angular.isDefined(i[t])?i[t].removeItem(e):!t&&e.group&&e.group.removeItem(e)},pinned:function(e,t){e.group&&e.group.pinned(e,t)},unpinned:function(e,t){e.group&&e.group.unpinned(e,t)}},o={onWindow:void 0,newStack:function(){return{items:[],stacked:{},addItem:function(e){if(-1==this.items.indexOf(e)){this.items.push(e);{this.items.length-1}e.stack=this}},removeItem:function(e){var t=this.items.indexOf(e);if(-1!=t){this.items.splice(t,1);for(var i in this.stacked){var o=this.stacked[i].indexOf(e);-1!=o&&this.stacked[i].splice(o,1)}}e.stack==this&&(e.stack=void 0)},shouldStack:function(e,t,i){if(e&&i.isPinned()&&e!=i&&e.stackGroupMatches(i.stackGroup)){i.group&&(i=i.group.getFirst(t));var o=i.getOriginalBounds(),n=e.getOriginalBounds();if((n.left>=o.left&&n.left<=o.right||n.right>=o.left&&n.right<=o.right||o.left>=n.left&&o.left<=n.right||o.right>=n.left&&o.right<=n.right)&&("top"==t&&n.top>=o.bottom||"bottom"==t&&n.bottom<=o.top)){if(!e.group)return!0;if(!i.group||e.group.id!=i.group.id){var r=e.group.getFirst(t);if(e==r||this.shouldStack(r,t,i))return!0}}}return!1},recalibrateStacked:function(e,t){for(var i=0;i<this.stacked[t].length;i++){var o=this.stacked[t][i];o.stackTargets&&o.stackTargets[t]&&-1!=o.stackTargets[t].indexOf(e)&&o.recalibratePosition()}},getStackTop:function(e,t){for(var i,o=e;i=o.stackedOn;)o=i;return o},getStackTarget:function(e,t){var i;if(e.stackTargets&&e.stackTargets[t])for(var o,n=0;n<e.stackTargets[t].length;n++){var r=e.stackTargets[t][n],s=r.$element[0].getBoundingClientRect(),l=s.top+("bottom"!=t?r.$element[0].offsetHeight:0);(angular.isUndefined(o)||"top"==t&&l>o||"bottom"==t&&o>l)&&(i=r,o=l)}return i},setStackTargets:function(e,t){for(var i=0;i<this.items.length;i++){var o=this.items[i];this.shouldStack(o,t,e)&&(angular.isUndefined(o.stackTargets[t])&&(o.stackTargets[t]=[]),-1==o.stackTargets[t].indexOf(e)&&o.stackTargets[t].push(e),o.recalibratePosition())}},removeStackTarget:function(e,t){for(var i=0;i<this.items.length;i++){var o=this.items[i];if(angular.isDefined(o.stackTargets[t])){var n=o.stackTargets[t].indexOf(e);-1!=n&&(o.stackTargets[t].splice(n,1),o.isPinned()&&o.edge&&o.edge.scroll==t&&o.recalibratePosition())}}},assignStacked:function(e,t){var i=this.getStackTarget(e,t);e.stackedOn=i&&i!=e?i:null,e.stackedOn&&(angular.isUndefined(e.stackedOn.stackedUnder)&&(e.stackedOn.stackedUnder=[]),-1==e.stackedOn.stackedUnder.indexOf(e)&&e.stackedOn.stackedUnder.push(e))},unassignStacked:function(e,t){if(e.stackedOn&&e.stackedOn.stackedUnder){var i=e.stackedOn.stackedUnder.indexOf(e);-1!=i&&e.stackedOn.stackedUnder.splice(i,1)}e.stackedOn=void 0},pinned:function(e,t){if(t.scroll){angular.isUndefined(this.stacked[t.scroll])&&(this.stacked[t.scroll]=[]);var i=this.stacked[t.scroll].indexOf(e);-1==i&&(this.stacked[t.scroll].push(e),this.setStackTargets(e,t.scroll)),this.assignStacked(e,t.scroll)}},unpinned:function(e,t){if(this.stacked[t.scroll]){var i=this.stacked[t.scroll].indexOf(e);-1!=i&&this.stacked[t.scroll].splice(i,1)}this.removeStackTarget(e,t.scroll),this.unassignStacked(e,t.scroll)}}},register:function(e){var t;e.$uiScrollpoint&&e.$uiScrollpoint.hasTarget&&e.$uiScrollpoint.$target?(angular.isUndefined(e.$uiScrollpoint.$target.stack)&&(e.$uiScrollpoint.$target.stack=this.newStack()),t=e.$uiScrollpoint.$target.stack):t=this.onWindow,t&&t.addItem(e)},unregister:function(e){e.stack&&e.stack.removeItem(e)},pinned:function(e,t){e.stack&&e.stack.pinned(e,t)},unpinned:function(e,t){e.stack&&e.stack.unpinned(e,t)}};o.onWindow=o.newStack();var n={pinned:function(e,t){n.Stack.pinned(e,t),n.Groups.pinned(e,t)},unpinned:function(e,t){n.Stack.unpinned(e,t),n.Groups.unpinned(e,t)},Groups:i,Stack:o};return n}]).directive("uiScrollpointPin",["ui.scrollpoint.Pin","$timeout","$window",function(e,t,i){return{restrict:"A",priority:100,require:["uiScrollpoint","uiScrollpointPin"],controller:["$scope","ui.scrollpoint.Pin","$timeout",function(e,t,i){var o=this;this.$attrs=void 0,this.$element=void 0,this.$placeholder=void 0,this.$uiScrollpoint=void 0,this.edge=void 0,this.stackGroup=void 0,this.stackAgainst=void 0,this.stackTargets={},this.overflow=void 0,this.overflowStick=!1,this.overflowUnstick=void 0,this.overflowFreeze=!1;var n,r,s={},l=!1;this.currentScrollDistance=function(){if(angular.isDefined(r)){var e=o.$uiScrollpoint.getScrollOffset();return r-e}return 0},this.calculateTopPosition=function(){var e=o.$element[0].getBoundingClientRect(),t=e.top+o.$uiScrollpoint.getScrollOffset();return o.overflow&&o.shouldOverflow()&&o.overflow.amount||(t-=o.currentScrollDistance()),t},this.getCurrentEdge=function(){return o.edge?o.$uiScrollpoint.getEdge(o.edge.scroll,o.edge.element):void 0},this.recalibratePosition=function(){o.$uiScrollpoint.$target.triggerHandler("scroll"),i(function(){if(o.edge&&o.$placeholder){var e=o.edge.scroll,t=(o.edge.element,o.getCurrentEdge()),i=o.$element[0].getBoundingClientRect(),n=i.top,r=o.stack?o.stack.getStackTarget(o,e):void 0;if(r){var s=r.$element[0].getBoundingClientRect(),l=s.top;"bottom"!=e?l+=r.$element[0].offsetHeight:l-=o.$element[0].offsetHeight,t.shift&&(l-=t.shift),n=l}if(i.top!=n){var a=n-i.top;o.$element.css("top",o.$element[0].offsetTop+a+"px"),o.stack&&o.stack.recalibrateStacked(o,e)}}})},this.repositionPinned=function(){if(o.$placeholder&&o.$uiScrollpoint&&!o.$uiScrollpoint.hasTarget){var e=o.currentScrollDistance(),t=o.$element[0].offsetTop,n=t-e,s=!1;if(o.stack&&!o.stackedOn&&o.edge&&o.edge.scroll&&o.stackTargets[o.edge.scroll]&&o.stackTargets[o.edge.scroll].length&&o.stack.assignStacked(o,o.edge.scroll),o.overflow&&o.stackedOn&&o.stackedOn.overflow!=o.overflow&&o.passOverflow(o.overflow),o.overflow)if(o.overflowStick)angular.isDefined(o.overflowUnstick)?(o.unstickOverflow(),o.overflowUnstuck=!0,s=!0):o.shouldFreezeTarget();else if(o.shouldOverflow())if(o.shouldStickOverflow()&&!o.overflowUnstuck)s=!0;else{o.overflowUnstuck&&(o.overflowUnstuck=void 0);var l=o.edge&&"bottom"==o.edge.scroll,a=-e;if(!l&&o.overflow.amount+a>o.overflow.allowance?a=o.overflow.allowance-o.overflow.amount:l&&o.overflow.amount+a<o.overflow.allowance&&(a=o.overflow.allowance-o.overflow.amount),n-=a,o.unfreezeTargets(a),o.overflow.root==o&&(o.overflow.amount+=a,(!l&&o.overflow.amount<0||l&&o.overflow.amount>0)&&(o.overflow.amount=0)),!o.overflowStick){var c,f,u=o.getCurrentEdge(),d=n+(u?u.shift:0),g=d+o.$element[0].offsetHeight;o.stackedOn?(c=o.stackedOn.calculateTopPosition(),f=c+o.stackedOn.$element[0].offsetHeight):l?l&&(c=o.$uiScrollpoint.getScrollOffset()+o.$uiScrollpoint.getTargetHeight(),f=0):(c=0,f=o.$uiScrollpoint.getScrollOffset());var h=0;!l&&d>f?h=d-f:l&&c>g&&(h=g-c),h&&(d-=h,n-=h)}}s||t!=n&&o.$element.css("top",n+"px"),r=o.$uiScrollpoint.getScrollOffset(),i(function(){o.calculateScrollAllowance()})}},this.shouldStickOverflow=function(){if(o.overflow&&o.edge&&!o.overflowStick&&!o.stackGroupMatches(o.overflow.root.stackGroup,!0)&&o.stackTargets[o.edge.scroll]){var e=o.getCurrentEdge();if(e){for(var t,i,n=(o.currentScrollDistance(),o.calculateTopPosition()+e.shift),r=(n+o.$element[0].offsetHeight,0);r<o.stackTargets[o.edge.scroll].length;r++){var s=o.stackTargets[o.edge.scroll][r],l=s.calculateTopPosition(),a=l+s.$element[0].offsetHeight,c=n-a;s!=o.stackedOn&&0>c&&(angular.isUndefined(t)||t>c)&&(i=s,t=c)}if(t)return o.stickOverflow(t),!0}}return o.overflowStick&&(o.overflowStick=!1,this.overflowUnstick=void 0),!1},this.stickOverflow=function(e){o.overflowStick=!0,o.$element.css("top",o.$element[0].offsetTop-e+"px"),o.stackedOn&&o.stackedOn.freezeOverflow(e)},this.unstickOverflow=function(){o.overflowUnstick&&(o.$element.css("top",o.$element[0].offsetTop-o.overflowUnstick.offset-o.currentScrollDistance()+"px"),o.stackedOn.overflowFreeze&&o.stackedOn.unfreezeOverflow(o.overflowUnstick.offset),o.overflowStick=!1,o.overflowUnstick=void 0)},this.shouldFreezeTarget=function(){if(o.overflowStick&&o.stackedOn&&!o.stackedOn.overflowFreeze){var e=o.getCurrentEdge(),t=o.calculateTopPosition()+e.shift,i=(t+o.$element[0].offsetHeight,o.stackedOn.calculateTopPosition()),n=i+o.stackedOn.$element[0].offsetHeight,r=t-n;0>r&&o.stackedOn.freezeOverflow(-r)}},this.unfreezeTargets=function(e){if(o.edge&&o.stackTargets&&o.stackTargets[o.edge.scroll])for(var t=o.getCurrentEdge(),i=o.calculateTopPosition()+t.shift,n=(i+o.$element[0].offsetHeight,0);n<o.stackTargets[o.edge.scroll].length;n++){var r=o.stackTargets[o.edge.scroll][n];if(r.overflowFreeze){var s=r.calculateTopPosition(),l=s+r.$element[0].offsetHeight,a=i-l;0>a&&r.unfreezeOverflow(-a)}}},this.freezeOverflow=function(e){o.overflowFreeze=!0,o.$element.css("top",o.$element[0].offsetTop-e+"px");for(var t=o;t=t.stackedOn;)t.shouldOverflow()&&t.freezeOverflow(e)},this.unfreezeOverflow=function(e){o.overflowFreeze&&(o.overflowFreeze=!1,o.$element.css("top",o.$element[0].offsetTop-e+"px"));for(var t=o;t=t.stackedOn;)t.unfreezeOverflow(e)},this.shouldOverflow=function(){return o.overflow&&o.stackedUnderGroup(o.overflow.root.stackGroup)&&!o.overflowStick&&!o.overflowFreeze},this.calculateScrollAllowance=function(){var e=!1;if(!o.stackedUnder||!o.stackedUnder.length){var t=o.$element[0].getBoundingClientRect(),i=o.$uiScrollpoint.getTargetHeight(),n=t.top+(o.overflow?o.overflow.amount:0),r=t.bottom+(o.overflow?o.overflow.amount:0),s=0;o.edge&&"top"==o.edge.scroll&&r>i?s=r-i:o.edge&&"bottom"==o.edge.scroll&&0>n&&(s=n),s&&(angular.isUndefined(o.overflow)||o.overflow.allowance!=s)&&(angular.isUndefined(o.overflow)&&(o.overflow={root:o,amount:0},e=!0),o.overflow.allowance=s)}e&&o.passOverflow(o.overflow)},this.passOverflow=function(e){if(o.edge){var t=o.stack.getStackTop(o,o.edge.scroll);t&&t!=o&&t.setOverflow(e)}},this.setOverflow=function(e){if(o.overflow=e,e||(o.overflowFreeze=!1,o.overflowStick=!1,this.overflowUnstick=void 0),o.stackedUnder)for(var t=0;t<o.stackedUnder.length;t++)o.stackedUnder[t].setOverflow(e)},this.setAttrs=function(e){this.$attrs=e},this.setElement=function(e){this.$element=e},this.setScrollpoint=function(e){this.$uiScrollpoint=e,n=this.$uiScrollpoint.checkOffset,this.$uiScrollpoint.checkOffset=this.checkOffset,this.$uiScrollpoint.cachePosition=function(){o.isPinned()||(this.posCache.top=this.getElementTop(!0))}},this.setStackAgainst=function(e){e&&!angular.isArray(e)&&(e=[e]),this.stackAgainst=e},this.setStackGroup=function(e){e&&!angular.isArray(e)&&(e=[e]),this.stackGroup=e},this.stackedUnderGroup=function(e){if(o.stackGroupMatches(e,!0))return!0;for(var t=o;t=t.stackedOn;)if(t.stackedUnderGroup(e))return!0;return!1},this.stackGroupMatches=function(e,t){var i;if(e&&this.stackGroup){for(i=0;i<this.stackGroup.length;i++)if(-1!=e.indexOf(this.stackGroup[i]))return!0}else if(angular.isUndefined(this.stackGroup)&&!t)return!0;if(this.stackAgainst&&!t)for(i=0;i<this.stackAgainst.length;i++)if("*"==this.stackAgainst[i]||e&&-1!=e.indexOf(this.stackAgainst[i]))return!0;return!1},this.getBounds=function(){return this.$element?this.$element[0].getBoundingClientRect():null},this.getOriginalBounds=function(){return this.$placeholder?this.$placeholder[0].getBoundingClientRect():this.getBounds()},this.isPinned=function(){return o.$placeholder?!0:!1},this.pin=function(e,n,a){if(!this.$placeholder&&this.$element&&this.$uiScrollpoint){var c={x:this.$element[0].offsetLeft,y:this.$element[0].offsetTop+a*("bottom"==e?-1:1)};if(o.$uiScrollpoint.cachePosition(),this.$placeholder=this.$element.clone(),this.$placeholder.addClass("placeholder"),this.$placeholder.css("visibility","hidden"),this.$element.after(this.$placeholder),this.$uiScrollpoint.hasTarget){l=this.$uiScrollpoint.$target!=this.$element.parent();var f=this.$element[0].getBoundingClientRect(),u=this.$uiScrollpoint.$target[0].getBoundingClientRect();c.x=f.left,c.y=this.$uiScrollpoint.$target[0].offsetTop+(f.top-u.top)+a*("bottom"==e?-1:1),l&&this.$uiScrollpoint.$target.append(this.$element)}s.position=this.$element[0].style.position,s.top=this.$element[0].style.top,s.left=this.$element[0].style.left,s.width=this.$element[0].style.width,this.$element.css("width",this.$element[0].offsetWidth+"px"),this.$element.addClass("pinned"),this.$element.css("position","absolute"),this.$element.css("left",c.x+"px"),this.$element.css("top",c.y+"px"),this.edge={scroll:e,element:n},r=this.$uiScrollpoint.getScrollOffset(),this.$uiScrollpoint.$target.on("scroll",o.repositionPinned),i(function(){o.calculateScrollAllowance()},1),t.pinned(this,this.edge,a)}},this.unpin=function(){if(this.$placeholder&&this.$element&&this.$uiScrollpoint){this.$uiScrollpoint.$target.off("scroll",o.repositionPinned),r=void 0,this.overflow&&this.passOverflow(void 0),this.overflow=void 0,this.overflowStick=!1,this.overflowUnstick=void 0,this.overflowFreeze=!1,this.$element.removeClass("pinned");for(var e in s)this.$element.css(e,s[e]);l&&this.$placeholder.after(this.$element);var i=this.edge;this.edge=void 0,this.$placeholder.remove(),this.$placeholder=void 0,t.unpinned(this,i)}},this.checkOffset=function(e,t,i){var n;i||(i=this.default_edge);var r;o.stack&&(r=o.stack.getStackTarget(o,e));var s="bottom"==e,l="top"==t,a="bottom"==t,c=this.getScrollOffset();s&&(c+=this.getTargetHeight());var f;if(i.absolute)f=i.percent?i.shift/100*this.getTargetScrollHeight():i.shift,s&&(f=this.getTargetContentHeight()-f,this.hasTarget&&(f+=this.getTargetHeight()));else if(l?f=this.getElementTop():a&&(f=this.getElementBottom()),f+=i.shift,r&&(c=r.calculateTopPosition()+(s?0:r.$element[0].offsetHeight),this.hasTarget&&(c=r.$element[0].offsetTop+(s?0:r.$element[0].offsetHeight),c+=this.getScrollOffset()-this.$target[0].offsetTop),r.overflowStick)){var u=o.calculateTopPosition();u+=i.shift,a&&(u+=o.$element[0].offsetHeight);var d=c-u;return(!s&&0>d||s&&d>0)&&(r.overflowUnstick={by:o,offset:d}),0}return n=c-f,s&&(n*=-1),n}}],link:function(o,n,r,s){function l(){d.unpin(),t(function(){u.$target.triggerHandler("scroll")},2)}function a(){d.unpin(),u.reset()}var c,f,u=s[0],d=s[1];d.setAttrs(r),d.setElement(n),d.setScrollpoint(u),r.$observe("uiScrollpoint",function(e){d.unpin()}),angular.isUndefined(r.uiScrollpointPinOverlap)&&e.Stack.register(d),r.$observe("uiScrollpointPinOverlap",function(t){t=t||t===!1?o.$eval(t):!0,t?(d.unpin(),e.Stack.unregister(d),n.addClass("pin-overlap")):(e.Stack.register(d),n.removeClass("pin-overlap"))}),r.$observe("uiScrollpointAbsolute",function(i){e.Stack.unregister(d),t(function(){e.Stack.register(d)})}),r.$observe("uiScrollpointEnabled",function(t){t=o.$eval(t),t?(angular.isUndefined(r.uiScrollpointPinOverlap)&&e.Stack.register(d),c&&e.Groups.register(d,c)):(d.unpin(),e.Stack.unregister(d),e.Groups.unregister(d,c))}),r.$observe("uiScrollpointPinGroup",function(t){t?(c&&e.Groups.unregister(d,c),c=t.replace(/[^a-zA-Z0-9-]/g,"-"),e.Groups.register(d,c)):(e.Groups.unregister(d,c),c=void 0)}),r.$observe("uiScrollpointPinStack",function(e){f=e?e.replace(/[^a-zA-Z0-9-,]/g,"-").split(","):void 0,d.setStackGroup(f)}),r.$observe("uiScrollpointPinStackAgainst",function(e){f=e?e.replace(/[^a-zA-Z0-9-,\*]/g,"-").split(","):void 0,d.setStackAgainst(f)}),u.addAction(function(e,t,i,o){e>=0&&!d.$placeholder?d.pin(i,o,e):0>e&&d.$placeholder&&d.unpin()}),o.$on("scrollpointShouldReset",l),angular.element(i).on("resize",a),n.on("$destroy",function(){angular.element(i).off("resize",a)})}}}])}();